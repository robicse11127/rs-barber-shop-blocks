!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("proxy-compare")):"function"==typeof define&&define.amd?define(["exports","proxy-compare"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).valtioVanilla={},e.proxyCompare)}(this,(function(e,t){"use strict";var r=function(e){return"object"==typeof e&&null!==e},n=Symbol(),o=new WeakSet,i=function(e,i,c,f,l,s,d,v,p){return void 0===e&&(e=Object.is),void 0===i&&(i=function(e,t){return new Proxy(e,t)}),void 0===c&&(c=function(e){return r(e)&&!o.has(e)&&(Array.isArray(e)||!(Symbol.iterator in e))&&!(e instanceof WeakMap)&&!(e instanceof WeakSet)&&!(e instanceof Error)&&!(e instanceof Number)&&!(e instanceof Date)&&!(e instanceof String)&&!(e instanceof RegExp)&&!(e instanceof ArrayBuffer)}),void 0===f&&(f=function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:throw e}}),void 0===l&&(l=new WeakMap),void 0===s&&(s=function(e,r,i,c){void 0===c&&(c=f);var a=l.get(r);if((null==a?void 0:a[0])===i)return a[1];var s=Array.isArray(e)?[]:Object.create(Object.getPrototypeOf(e));return t.markToTrack(s,!0),l.set(r,[i,s]),Reflect.ownKeys(e).forEach((function(i){var a=Reflect.get(e,i,r);o.has(a)?(t.markToTrack(a,!1),s[i]=a):a instanceof Promise?Object.defineProperty(s,i,{get:function(){return c(a)}}):null!=a&&a[n]?s[i]=u(a,c):s[i]=a})),Object.freeze(s)}),void 0===d&&(d=new WeakMap),void 0===v&&(v=[1]),void 0===p&&(p=function(o){if(!r(o))throw new Error("object required");var u=d.get(o);if(u)return u;var f=v[0],l=new Set,p=function(e,t){void 0===t&&(t=++v[0]),f!==t&&(f=t,l.forEach((function(r){return r(e,t)})))},y=new Map,b=function(e){var t=y.get(e);return y.delete(e),t},g=Array.isArray(o)?[]:Object.create(Object.getPrototypeOf(o)),h=i(g,{get:function(e,t,r){return t===n?[e,r,f,s,l]:Reflect.get(e,t,r)},deleteProperty:function(e,t){var r,o=Reflect.get(e,t),i=null==o||null==(r=o[n])?void 0:r[4];i&&i.delete(b(t));var c=Reflect.deleteProperty(e,t);return c&&p(["delete",[t],o]),c},set:function(o,i,u,f){var l,s,d=Reflect.has(o,i),v=Reflect.get(o,i,f);if(d&&e(v,u))return!0;var g=null==v||null==(l=v[n])?void 0:l[4];g&&g.delete(b(i)),r(u)&&(u=t.getUntracked(u)||u);var h=u;if(null!=(s=Object.getOwnPropertyDescriptor(o,i))&&s.set);else if(u instanceof Promise)u.then((function(e){u.status="fulfilled",u.value=e,p(["resolve",[i],e])})).catch((function(e){u.status="rejected",u.reason=e,p(["reject",[i],e])}));else{var j,w;null!=(j=u)&&j[n]||!c(u)||(h=a(u)),null!=(w=h)&&w[n]&&h[n][4].add(function(e){var t=y.get(e);return t||(t=function(t,r){var n=[].concat(t);n[1]=[e].concat(n[1]),p(n,r)},y.set(e,t)),t}(i))}return Reflect.set(o,i,h,f),p(["set",[i],u,v]),!0}});return d.set(o,h),Reflect.ownKeys(o).forEach((function(e){var t=Object.getOwnPropertyDescriptor(o,e);t.get||t.set?Object.defineProperty(g,e,t):h[e]=o[e]})),h}),[p,n,o,e,i,c,f,l,s,d,v]},c=i()[0];function a(e){return void 0===e&&(e={}),c(e)}function u(e,t){var r=e[n],o=r[0],i=r[1],c=r[2];return(0,r[3])(o,i,c,t)}var f=i;e.getVersion=function(e){var t=null==e?void 0:e[n];return null==t?void 0:t[2]},e.proxy=a,e.ref=function(e){return o.add(e),e},e.snapshot=u,e.subscribe=function(e,t,r){var o,i=[],c=e[n][4],a=function e(n){i.push(n),r?t(i.splice(0)):o||(o=Promise.resolve().then((function(){o=void 0,c.has(e)&&t(i.splice(0))})))};return c.add(a),function(){return c.delete(a)}},e.unstable_buildProxyFunction=f}));
